{% block models_box %}
{% load profile_components %}
{% load static %}

<link rel="stylesheet" type="text/css" href="{% static 'css/users/components/models-box.css' %}">
<div class="container models shadow p-3 mb-3 bg-body rounded">
  <h2>Models</h2>
  <table id="models-box" class="table table-hover">
    <thead>
      <tr>
        <th scope="col">
          ID
        </th>
        <th scope="col">
          Name
        </th>
        <th scope="col">
          Type
        </th>
        <th scope="col">
          Repository
        </th>
        <th scope="col"><center>
          Language
        </center></th>
        <th scope="col"><center>
          Predictions
        </center></th>
        <th scope="col" data-sort-default="desc"><center>
          Updated
        </center></th>
      </tr>
    </thead>
    <tbody>
      {% for model in models %}
      <tr onclick="handleModelClick('{{model.id}}')">
        <td>{{model.id}}</td>
        <td>{{model.name}}</td>
        <td>{{model.type}}</td>
        <td><a href="{{ model.repository }}">{{model.repository|get_repo}}</a></td>
        <td><center>{{model.implementation_language}}</center></td>
        <td><center>{{model.predictions_count}}</center></td> 
        <td><center>{{model.updated|date:"Y-m-d"}}</center></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="card model-card text-center mb-3 shadow" style="display: none;">
  <div class="card-header">
    <ul class="nav nav-tabs card-header-tabs">
      <li class="nav-item">
        <a class="nav-link active" aria-current="true" href="#" onclick="changeTab(event, 'info')">Info</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="" onclick="changeTab(event, 'json')">JSON</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="" onclick="changeTab(event, 'curl')">Curl</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="" onclick="changeTab(event, 'python')">Python</a>
      </li>
      <div class="ms-auto">
        <a id="predictions-link" href="#" target="_blank" class="btn btn-primary">
          Predictions
          <i class="fa-solid fa-square-arrow-up-right"></i>
        </a>
      </div>
    </ul>
  </div>
  <div class="card-body">
    <div id="info-tab" class="tab-content">
      <div class="info-tab-item">
        <div class="info-tab-item-var">Name: </div>
        <div id="model-name"></div>
      </div>
      <div class="info-tab-item">
        <div class="info-tab-item-var">Description: </div>
        <div id="model-description"></div>
      </div>
      <div class="info-tab-item">
        <div class="info-tab-item-var">Repository: </div>
        <div id="model-repository"></div>
      </div>
      <div class="info-tab-item">
        <div class="info-tab-item-var">Implementation Language: </div>
        <div id="model-language"></div>
      </div>
      <div class="info-tab-item">
        <div class="info-tab-item-var">Type: </div>
        <div id="model-type"></div>
      </div>
      {% if user.username == user_profile.username %}
      <div class="ms-auto">
        <a id="edit-model" href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#update-model">
          Edit Model
        </a>
        <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#delete-model">Delete Model</button>
      </div>
      {% endif %}
    </div>
    <div id="json-tab" class="tab-content" style="display: none;">
      <pre><code id="model-json"></code></pre>
    </div>
    <div id="curl-tab" class="tab-content" style="display: none;">
      <pre><code id="curl-model-command" class="curl-command"></code></pre>
    </div>
    <div id="python-tab" class="tab-content" style="display: none;">
      <pre><code id="python-model-code" class="python"></code></pre>
    </div>
  </div>
</div>

{% if user.is_authenticated %}
<div class="modal fade" id="delete-model" tabindex="-1" role="dialog" aria-labelledby="delete-model-label" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="delete-model-label">Delete Model {{model.id}}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form method="post" id="deleteModelForm" action="{% url 'profile' username=user.username %}">
        {% csrf_token %}
        <input type="hidden" id="delete-model-id" name="model_id" value="{{ model_id }}">
        <div class="modal-body">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" name="delete_model" class="btn btn-danger">Delete</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endif %}

{% if user.is_authenticated %}
<div class="modal fade" id="update-model" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="update-model-label" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="update-model-label">Update Model {{model.id}}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form method="post" id="updateModelForm" action="{% url 'profile' username=user.username %}">
        {% csrf_token %}
        <input type="hidden" id="update-model-id" name="model_id" value="{{ model_id }}">
        <div class="modal-body">
          <div class="row mb-3">
            <div class="col">
              <label for="model_name">Model Name:</label>
              <input type="text" id="update-model-name" name="model_name" value="{{ model.name }}" class="form-control" maxlength="100" required>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col">
              <label for="model_description">Description:</label>
              <textarea rows="4" id="update-model-desc" name="model_description" value="{{ model.description|default_if_none:"" }}" class="form-control" maxlength="255"></textarea>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col">
              <label for="model_repository">Github Repository:</label>
              <input type="text" id="update-model-repo" name="model_repository" value="{{ model.repository }}" class="form-control" maxlength="150" required>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col">
              <label for="model_type">Type:</label>
              <input type="text" id="update-model-type" name="model_type" value="{{ model.type }}" class="form-control" maxlength="100" required>
            </div>
            <div class="col">
              <label for="model_language">Implementation language:</label>
              <input type="text" id="update-model-lang" name="model_language" value="{{ model.implementation_language }}" class="form-control" maxlength="100" required>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" name="update_model" class="btn btn-primary">Update</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endif %}

{% endblock %}
