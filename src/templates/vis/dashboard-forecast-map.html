{% extends 'main/base.html' %}
{% load i18n %}
{% load plotly_dash %}
{% load filters %}

{% block title %}{% translate "Visualization" %}{% endblock %}

{% block content %}
<div style="display:flex;">
  <div class="vis-sidebar d-flex flex-column flex-shrink-0 bg-dark">
    <div class="sidebar-menu">
      <center>
        <div class="p-3" id="date">
          <label for="date" class="text-white"><b>{% trans "Select the date:" %}</b></label><br>
          <select name="date" class="form-select" aria-label="select">
            <option value="" hidden selected>Date</option>
            {% for date in available_dates %}
            <option value="{{ date }}">{{ date }}</option>
            {% endfor %}
          </select>
        </div>

        <hr style="color:white;">

        <p class="text-white"><b>Select the region:</b></p>
        
      </center>

      <div class="ps-3">
        <div class="form-check">
          <input class="form-check-input" type="radio" name="flexRadioDefault" id="select-national" checked onChange="showRegionSelect()">
          <label class="form-check-label text-white" for="select-national">
            {% trans "National" %}
          </label>
        </div>

        <div class="form-check">
          <input class="form-check-input" type="radio" name="flexRadioDefault" id="select-macroregion" onChange="showRegionSelect()">
          <label class="form-check-label text-white" for="select-macroregion">
            {% trans "Macroregion" %}
          </label>
        </div>

        <div class="form-check">
          <input class="form-check-input" type="radio" name="flexRadioDefault" id="select-state" onChange="showRegionSelect()">
          <label class="form-check-label text-white" for="select-state">
            {% trans "State" %}
          </label>
        </div>

        <div class="form-check">
          <input class="form-check-input" type="radio" name="flexRadioDefault" id="select-macro-saude" onChange="showRegionSelect()">
          <label class="form-check-label text-white" for="select-macro-saude">
            {% trans "Macro Sa√∫de" %}
          </label>
        </div>
      </div>

      <div id="macroregion" class="region-select p-4">
        <select class="form-select" aria-label="select">
          <option value="" hidden selected disabled>{% trans "Select macroregion" %}</option>
          {% for geocode, name in macroregions %}
          <option value="{{ geocode }}">{{ name }}</option>
          {% endfor %}
        </select>
      </div>

      <div id="state" class="region-select p-4">
        <select class="form-select" aria-label="select">
          <option value="" hidden selected disabled>{% trans "Select state" %}</option>
          {% for uf, name in ufs %}
          <option value="{{ uf }}">{{ name }}</option>
          {% endfor %}
        </select>
      </div>

      <div id="macroSaude" class="region-select p-4">
        <select class="selectpicker p-0" multiple>
          {% for geocode, name, uf in macros_saude %}
          <option value="{{ geocode }}">{{ name }} - {{ uf }}</option>
          {% endfor %}
        </select>
      </div>

      <br>

      <center>

        <button type="button" class="btn btn-secondary">{% trans "Generate map" %}</button>

      </center>
    </div>
  </div>

  <div class="vis-content d-flex flex-column justify-content-center align-items-center flex-shrink-0 p-3 bg-light" style="height: auto;">
    <div class="macro-forecast-chart">
      <center>
        <iframe 
         id="macroForecastIframe" 
         src="http://0.0.0.0:8042/vis/macro-forecast-map/?date=2024-04-28"
         style="width: 100%; height: 100%; border: none;"
         ></iframe>
      </center>
    </div>
  </div>
</div>

<style>
.vis-sidebar {
  width: 280px;
  min-height: calc(100vh - 211px);
}

.vis-content {
  flex-grow: 1;
}

.macro-forecast-chart {
  width: 1150px; 
  height: auto; 
  overflow: hidden;
}

#macroForecastIframe {
  background-color: #FFFFFF;
  min-height: calc(100vh - 211px);
}
</style>

<script>
$(".region-select").hide();

function showRegionSelect() {
  $(".region-select").hide();
  if ($("#select-macroregion").is(":checked")) {
    $("#macroregion").show();
  } else if ($("#select-state").is(":checked")) {
    $("#state").show();
  } else if ($("#select-macro-saude").is(":checked")) {
    $("#macroSaude").show();
  }
}
</script>

{% endblock %}
