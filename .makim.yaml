version: 1.8.1

groups:

  docker:
    env-file: .env
    targets:
      build:
        help: Build containers
        run: |
          sugar build --group $ENV

      start:
        help: Start all containers
        run: |
          sugar up --group $ENV --options "--no-start"
          sugar start --group $ENV

      stop:
        help: Start all containers
        run: |
          sugar stop --group $ENV

  django:
    targets:
      createsuperuser:
        args:
          email:
            help: Specify the email
            type: string
            required: True
          username:
            help: Specify the username
            type: string
            required: True
          password:
            help: Specify the password
            type: string
            required: True
        help: Run `createsuperuser` inside container
        run: |
          bash -c "export DJANGO_SUPERUSER_PASSWORD={{ args.password }}"
          sugar run --service django --cmd "python manage.py createsuperuser \
            --noinput --username {{ args.username }} --email {{ args.email }}"

      migrate:
        help: Run `migrate` inside container
        env-file: .env
        run: |
          sugar run --service django --cmd "python manage.py migrate --no-input"

      collectstatic:
        help: Run `collectstatic` inside container
        run: |
          sugar run --service django --cmd "python manage.py collectstatic --no-input"

  dev:
    targets:
      dotenv:
        help: Configure .env file
        run: |
          python contrib/scripts/do_dotenv.py

      psql-conf:
        help: Configure postgresq.conf file
        run: |
          python contrib/scripts/do_psqlconf.py
